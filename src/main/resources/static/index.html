<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <style>
        .a1{
                width: 120px;
            }
        .a2{
            width: 200px;
        }
        .a3{
            width: 380px;
            height: 50px;
            display: flex;
            justify-content: space-between;
        }
    </style>
</head>
<body>
<div style="width: 400px;height: auto;margin: auto;">
    <div class="a3"><p class="a1">Email:</p> <input class="a2"  type="email" id="m" placeholder="nhap vao email"></div>
    <div class="a3"><p class="a1">User Name: </p><input class="a2" type="text" placeholder="nhap vao username"></div>
    <div class="a3"><p class="a1">Pass:</p> <input class="a2" type="text" placeholder="nhap vao pass"></div>
    <div class="a3" id="cfcode" style="display: none">
        <p class="a1">Ma xac nhan</p><input type="text" placeholder="mã xác nhận" id="mxn">
        <button id="cfbtn" style="width: 150px;" onclick="cf1()">
            <p style="margin-top: 6px;margin-bottom: 0px">Xác Nhận Mã</p>
            <p id="cd" style="margin-top: 4px;color: orange">60s</p>
        </button>
    </div>
    <button onclick="getInfo()"> Xác Nhận</button>
    <button onclick="getCode()"> Gui lai ma</button>
</div>

</body>
</html>
<script>
    let mail;
    let loop;
    function getInfo(){
        mail=document.getElementById("m").value
        getCode()
    }
    function getCode(){
        clearInterval(loop)
        $.ajax(
            {
                type:"GET",

                url:"http://localhost:8080/mail?email="+mail,
                success: function (data) {
                       waitConfirm();
                },
                error: function (err) {
                    console.log(err)
                }
            }

        )
    }
    function waitConfirm(){
        document.getElementById("cfcode").style.display="flex"
        let time=60
          loop= setInterval(function (){
                if (time>0){
                document.getElementById("cd").innerHTML=time+"s"
                time--;
                }else {
                    document.getElementById("cfbtn").disabled = true;
                    document.getElementById("cd").innerText="code het han"
                    clearInterval(loop)
                    $.ajax({
                        type:"GET",
                        url:"http://localhost:8080/mail/resetcode",
                        success: function (data) {
                        },
                        error: function (err) {
                            console.log(err)
                        }

                    })
                }
            },1000)

    }


    function cf1(){
        let code=document.getElementById("mxn").value
        $.ajax(
            {
                type:"GET",

                url:"http://localhost:8080/mail/confirm?code="+code,
                success: function (data) {
                    alert(data)
                },
                error: function (err) {
                    console.log(err)
                }
            }

        )
    }
</script>